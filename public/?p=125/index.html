<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>VMkernel: vMotion and Provisioning in dedicated TCP/IP stacks | IT Gaiden</title>
<meta name="keywords" content="networking, VMware, vswitch" />
<meta name="description" content="It’s been a while since I posted something, but I was busy with university duties and to be honest I couldn’t spend time on publishing things but, here we are!First, I am currently studying for the VCAP6 – DCV Deployment Exam (3V0-623) and I am learning a lot with it, so maybe I will post more topics related with.Today I am going to talk about TCP/IP stacks in VMkernels (for vSphere 6).">
<meta name="author" content="itgaiden">
<link rel="canonical" href="https://dangaiden.github.io/?p=125/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.35cd0f65a15cafa92372b8313deef5960aae04b90ad722f2bbf509eb0468137e.css" integrity="sha256-Nc0PZaFcr6kjcrgxPe71lgquBLkK1yLyu/UJ6wRoE34=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://dangaiden.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://dangaiden.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://dangaiden.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://dangaiden.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://dangaiden.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.85.0" />
<meta property="og:title" content="VMkernel: vMotion and Provisioning in dedicated TCP/IP stacks" />
<meta property="og:description" content="It’s been a while since I posted something, but I was busy with university duties and to be honest I couldn’t spend time on publishing things but, here we are!First, I am currently studying for the VCAP6 – DCV Deployment Exam (3V0-623) and I am learning a lot with it, so maybe I will post more topics related with.Today I am going to talk about TCP/IP stacks in VMkernels (for vSphere 6)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dangaiden.github.io/?p=125/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-23T18:19:09&#43;00:00" />
<meta property="article:modified_time" content="2018-07-23T18:19:09&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="VMkernel: vMotion and Provisioning in dedicated TCP/IP stacks"/>
<meta name="twitter:description" content="It’s been a while since I posted something, but I was busy with university duties and to be honest I couldn’t spend time on publishing things but, here we are!First, I am currently studying for the VCAP6 – DCV Deployment Exam (3V0-623) and I am learning a lot with it, so maybe I will post more topics related with.Today I am going to talk about TCP/IP stacks in VMkernels (for vSphere 6)."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://dangaiden.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "VMkernel: vMotion and Provisioning in dedicated TCP/IP stacks",
      "item": "https://dangaiden.github.io/?p=125/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "VMkernel: vMotion and Provisioning in dedicated TCP/IP stacks",
  "name": "VMkernel: vMotion and Provisioning in dedicated TCP\/IP stacks",
  "description": "It’s been a while since I posted something, but I was busy with university duties and to be honest I couldn’t spend time on publishing things but, here we are!First, I am currently studying for the VCAP6 – DCV Deployment Exam (3V0-623) and I am learning a lot with it, so maybe I will post more topics related with.Today I am going to talk about TCP/IP stacks in VMkernels (for vSphere 6).",
  "keywords": [
    "networking", "VMware", "vswitch"
  ],
  "articleBody": "It’s been a while since I posted something, but I was busy with university duties and to be honest I couldn’t spend time on publishing things but, here we are!First, I am currently studying for the VCAP6 – DCV Deployment Exam (3V0-623) and I am learning a lot with it, so maybe I will post more topics related with.Today I am going to talk about TCP/IP stacks in VMkernels (for vSphere 6). This is a thing that I didn’t care so much when I studied for the VCP6-DCV but now with the VCAP and all the time spent in the lab I thought that it was a great topic to talk!So, get down to brass tacks.Just as a reminder, a VMkernel port is a port you create in an ESXi host to connect with the “outside world” (outside the host), so when you want to communicate two hosts, each host will have a VMkernel port to communicate.TCP/IP stacks A TCP/IP stack is a set of networking protocols (Do you remember the OSI Model?) used to provide networking support for the services that it handles. So you can use different stacks to support in different ways a service within the stack.A quick look at the services you can choose when creating a VMkernel port:I am not going to explain each one because we are going to focus on vMotion and Provisioning traffic.Continuing with TCP/IP stacks, when you create a new VMkernel in an ESXi host, you can choose which services do you want to enable: Regarding vMotion and Provisioning TCP/IP stacks you could do it in two ways:I must admit I always use the first one, the Default TCP/IP stack with the service enabled, so which should we use, the dedicated stack or the default one?Dedicated TCP/IP stack options  vMotion:It provides better isolation (more security), a separate set of buffers and sockets and avoids routing table conflicts than using the same TCP/IP Stack. Provisioning:Used for cold VM migration (migrate power-off VMs), cloning and snapshot traffic.  So, I discussed with some people because I wanted to know which benefit could give you to use the dedicated TCP/IP stacks and this is what I gathered: For vMotion:As a short answer, I would say, that if you need to do Cross vCenter vMotionyou will need it because the dedicated stack gives you a Layer 3 VMkernel, meaning routing. With a dedicated stack, you can change the Gateway and DNS used in the default TCP/IP stack, meaning that you don’t have to use the same stack options that other services.do. For Provisioning traffic:If you have massive data coming from snapshots or cloning, is better that you use this dedicated stack instead of the default one.  In the end, this is my recap and I hope it can help someone that is not familiar with it. Obviously, you could use the dedicated TCP/IP stackwhenever you want but bear in mind that it will disable that service in the rest of the VMkernels.Anyway, if you think that I missed or want to discuss something, let me know in the comments!",
  "wordCount" : "513",
  "inLanguage": "en",
  "datePublished": "2018-07-23T18:19:09Z",
  "dateModified": "2018-07-23T18:19:09Z",
  "author":{
    "@type": "Person",
    "name": "itgaiden"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dangaiden.github.io/?p=125/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "IT Gaiden",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dangaiden.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://dangaiden.github.io" accesskey="h" title="IT Gaiden (Alt + H)">IT Gaiden</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      VMkernel: vMotion and Provisioning in dedicated TCP/IP stacks
    </h1>
    <div class="post-meta">July 23, 2018&nbsp;·&nbsp;itgaiden
</div>
  </header> 
  <div class="post-content"><p><!-- raw HTML omitted -->It’s been a while since I posted something, but I was busy with university duties and to be honest I couldn’t spend time on publishing things but, here we are!<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->First, I am currently studying for the <!-- raw HTML omitted -->VCAP6 – DCV Deployment Exam (3V0-623) <!-- raw HTML omitted -->and I am learning a lot with it, so maybe I will post more topics related with.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Today I am going to talk about <!-- raw HTML omitted -->TCP/IP stacks in VMkernels <!-- raw HTML omitted -->(for vSphere 6). This is a thing that I didn’t care so much when I studied for the VCP6-DCV but now with the VCAP and all the time spent in the lab I thought that it was a great topic to talk!<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->So, get down to brass tacks.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Just as a reminder, a VMkernel port is a port you create in an ESXi host to connect with the “outside world” (outside the host), so when you want to communicate two hosts, each host will have a VMkernel port to communicate.<!-- raw HTML omitted --></p>
<h2 id="span-stylefont-size-24px-font-family-nunito-color-000000tcpip-stacksspan"><!-- raw HTML omitted -->TCP/IP stacks<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-size-24px-font-family-nunito-color-000000tcpip-stacksspan">#</a></h2>
<p><!-- raw HTML omitted -->A TCP/IP stack is a set of networking protocols (Do you remember the OSI Model?) used to provide networking support for the services that it handles. So you can use different stacks to support in different ways a service within the stack.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->A quick look at the services you can choose when creating a VMkernel port:<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->I am not going to explain each one because we are going to focus on <!-- raw HTML omitted -->vMotion and Provisioning traffic<!-- raw HTML omitted -->.<!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Continuing with TCP/IP stacks, when you create a new VMkernel in an ESXi host, you can choose which services do you want to enable:  <!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Regarding vMotion and Provisioning TCP/IP stacks you could do it in two ways:<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->I must admit I always use the first one, the Default TCP/IP stack with the service enabled, so which should we use, the dedicated stack or the default one?<!-- raw HTML omitted --></p>
<h2 id="span-stylefont-size-24px-font-family-nunito-color-000000dedicated-tcpip-stack-optionsspan"><!-- raw HTML omitted -->Dedicated TCP/IP stack options<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-size-24px-font-family-nunito-color-000000dedicated-tcpip-stack-optionsspan">#</a></h2>
<ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->vMotion:<!-- raw HTML omitted --> <!-- raw HTML omitted -->It provides better isolation (more security), a separate set of buffers and sockets and avoids routing table conflicts than using the same TCP/IP Stack.<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Provisioning:<!-- raw HTML omitted --> <!-- raw HTML omitted --> Used for cold VM migration (migrate power-off VMs), cloning and snapshot traffic.<!-- raw HTML omitted --></li>
</ul>
<p><!-- raw HTML omitted -->So, I discussed with some people because I wanted to know which benefit could give you to use the dedicated TCP/IP stacks and this is what I gathered:<!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted -->For vMotion:<!-- raw HTML omitted --> As a short answer, I would say, that if you need to do <!-- raw HTML omitted -->Cross vCenter vMotion<!-- raw HTML omitted --> you will need it because the dedicated stack gives you a  Layer 3 VMkernel, meaning routing. With a dedicated stack, you can change the Gateway and DNS used in the default TCP/IP stack, meaning that you don’t have to use the same stack options that other services.do.<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted --><!-- raw HTML omitted -->For Provisioning traffic:<!-- raw HTML omitted --> If you have massive data coming from snapshots or cloning, is better that you use this dedicated stack instead of the default one.<!-- raw HTML omitted --></li>
</ul>
<p><!-- raw HTML omitted -->In the end, this is my recap and I hope it can help someone that is not familiar with it. Obviously, you could <!-- raw HTML omitted -->use the dedicated TCP/IP stack<!-- raw HTML omitted --> whenever you want but bear in mind that <!-- raw HTML omitted -->it will disable that service in the rest of the VMkernels<!-- raw HTML omitted -->.<!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Anyway, if you think that I missed or want to discuss something, let me know in the comments!<!-- raw HTML omitted --></p>


  </div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://dangaiden.github.io/tags/networking/">networking</a></li>
      <li><a href="https://dangaiden.github.io/tags/vmware/">VMware</a></li>
      <li><a href="https://dangaiden.github.io/tags/vswitch/">vswitch</a></li>
    </ul>
  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="https://dangaiden.github.io">IT Gaiden</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
