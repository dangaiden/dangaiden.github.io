<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Migrating ADFS from 2012 R2 (3.0 v) to 2016 (4.0 v.) | IT Gaiden</title>
<meta name="keywords" content="ADFS" />
<meta name="description" content="I will explain today how to migrate ADFS from 2012 R2 (3.0 v) to 2016 (4.0) without almost no downtime. The overall process consists in adding the new ADFS server to the farm, assign the primary role to the new ADFS, make some changes and then we’re done. The current environment is: 1 x WAP Server (W2012 R2) 1 x ADFS Server (W2012 R2)  No applications published, just an Office 365 Relying party trust.">
<meta name="author" content="itgaiden">
<link rel="canonical" href="https://dangaiden.github.io/?p=942/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.35cd0f65a15cafa92372b8313deef5960aae04b90ad722f2bbf509eb0468137e.css" integrity="sha256-Nc0PZaFcr6kjcrgxPe71lgquBLkK1yLyu/UJ6wRoE34=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://dangaiden.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://dangaiden.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://dangaiden.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://dangaiden.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://dangaiden.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.85.0" />
<meta property="og:title" content="Migrating ADFS from 2012 R2 (3.0 v) to 2016 (4.0 v.)" />
<meta property="og:description" content="I will explain today how to migrate ADFS from 2012 R2 (3.0 v) to 2016 (4.0) without almost no downtime. The overall process consists in adding the new ADFS server to the farm, assign the primary role to the new ADFS, make some changes and then we’re done. The current environment is: 1 x WAP Server (W2012 R2) 1 x ADFS Server (W2012 R2)  No applications published, just an Office 365 Relying party trust." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dangaiden.github.io/?p=942/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-31T21:12:50&#43;00:00" />
<meta property="article:modified_time" content="2019-07-31T21:12:50&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Migrating ADFS from 2012 R2 (3.0 v) to 2016 (4.0 v.)"/>
<meta name="twitter:description" content="I will explain today how to migrate ADFS from 2012 R2 (3.0 v) to 2016 (4.0) without almost no downtime. The overall process consists in adding the new ADFS server to the farm, assign the primary role to the new ADFS, make some changes and then we’re done. The current environment is: 1 x WAP Server (W2012 R2) 1 x ADFS Server (W2012 R2)  No applications published, just an Office 365 Relying party trust."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://dangaiden.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Migrating ADFS from 2012 R2 (3.0 v) to 2016 (4.0 v.)",
      "item": "https://dangaiden.github.io/?p=942/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Migrating ADFS from 2012 R2 (3.0 v) to 2016 (4.0 v.)",
  "name": "Migrating ADFS from 2012 R2 (3.0 v) to 2016 (4.0 v.)",
  "description": "I will explain today how to migrate ADFS from 2012 R2 (3.0 v) to 2016 (4.0) without almost no downtime. The overall process consists in adding the new ADFS server to the farm, assign the primary role to the new ADFS, make some changes and then we’re done. The current environment is: 1 x WAP Server (W2012 R2) 1 x ADFS Server (W2012 R2)  No applications published, just an Office 365 Relying party trust.",
  "keywords": [
    "ADFS"
  ],
  "articleBody": "I will explain today how to migrate ADFS from 2012 R2 (3.0 v) to 2016 (4.0) without almost no downtime. The overall process consists in adding the new ADFS server to the farm, assign the primary role to the new ADFS, make some changes and then we’re done. The current environment is: 1 x WAP Server (W2012 R2) 1 x ADFS Server (W2012 R2)  No applications published, just an Office 365 Relying party trust.A DNS A record that points sts.teselia.comto the ADFS IP address. And the future environment will be: 1 x WAP Server (W2016) - Not in this post 1 x ADFS Server (W2016) - In this post  Planning for your ADFS Migration  Active Directory schema update using ‘ADPrep’ with the Windows Server 2016 additions (not necessary in my case) Build a Windows Server 2016 server with ADFS and join into an existing farm. Promote one of the ADFS 2016 servers as “primary” of the farm, and point all other secondary servers to the new “primary”. Change DNS records to the new servers’s IP address. Raise the Farm Behavior Level feature (FBL) to ‘2016’ Test that the setup works correctly. Remove the old ADFS server (W2012 R2) from the farm.   Upgrading Schema Now, time to upgrade the schema of the AD:Put the installation media from W2016 Datacenter:Adprep /forestprepIn my case, it was already updated (my domain is in W2012 R2 so it seems that I don’t need it). Installing and configuring ADFS Once we deployed a new Windows Server 2016 and it’s joined to our domain…Install the role of ADFS in your target server and then continue with the post-deployment config: Provide can account with Domain Administrator permissions: Provide your federation service name. You can review it in the current ADFS primary server and click Properties in the root folder of the ADFS console: In our case “sts.teselia.com”: Specify your SSL certificate (usually your wildcard): Then, I will use an account (Managed service account recommended): Review your configuration and after the pre-requisite checks proceed with the «Configure» button: After the server is installed you will have some warnings that will be fixed later by rebooting the server and making this new server as the primary ADFS server in the farm:Then, we will proceed to reboot our server (ADFS01.teselia.com). Configuring as a «PrimaryComputer» in the ADFS farm Once the machine has restarted, open the ADFS Management Console, and you’ll notice it’s not the primary federation server in the farm.Open a PS console and execute: Set-AdfsSyncProperties -Role PrimaryComputer After that, I can access the ADFS console from our new ADFS server without the warning: Execute this on the other ADFS servers (we will point the new ADFS server as the PRIMARY):Set-AdfsSyncProperties -Role SecondaryComputer -PrimaryComputerName sts.teselia.comThen, we will check that in our old ADFS server it’s correct: Details to bear in mind So, in my case, I have a DNS A record that points sts.teselia.comto an IP address (the ADFS server)After pointing the new, I had to modify the hosts file from the WAP server in the DMZ to point to the new server!Also, I modified the DNS record from the internal DNSwith the new server’s IP address.  Error with 0365 relying party trust After migrating the service from ADFS 3.0 (W2012 R2) to ADFS 4.0 (W2016), I faced a problem when updating the O365 relying party trust.The solution was to apply a fix described by Microsoft:https://docs.microsoft.com/en-us/security-updates/SecurityAdvisories/2015/2960358Basically, what you have to do is to add a couple of registry values in this new ADFS server because it’s Windows Server 2016 and is running ADFS 4.0 version.Once you applied the fix, reboot it and works flawlessly! Testing the new setup To check that it’s really working, try to log into your Office 365 portal and it must show you the portal from your federation service.As the WAP service isn’t migrated yet, it should respond correctly but if the configuration is not correct, it won’t be able to gather the configuration from the ADFS service.Removing the old ADFS server Once you tested that it works correctly, as both ADFS servers will have the configuration replicated, you can remove the role from the old one (that now holds the secondary role) and then remove it from the domain.With that done, you will have a fresh new Windows Server 2016 ADFS server and none «old» ADFS servers.  And that’s all, I will do in the future another post about the WAP service migration that it’s easier than this one, I hope that this can help someone.",
  "wordCount" : "750",
  "inLanguage": "en",
  "datePublished": "2019-07-31T21:12:50Z",
  "dateModified": "2019-07-31T21:12:50Z",
  "author":{
    "@type": "Person",
    "name": "itgaiden"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dangaiden.github.io/?p=942/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "IT Gaiden",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dangaiden.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://dangaiden.github.io" accesskey="h" title="IT Gaiden (Alt + H)">IT Gaiden</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Migrating ADFS from 2012 R2 (3.0 v) to 2016 (4.0 v.)
    </h1>
    <div class="post-meta">July 31, 2019&nbsp;·&nbsp;itgaiden
</div>
  </header> 
  <div class="post-content"><p><!-- raw HTML omitted -->I will explain today how to migrate ADFS from 2012 R2 (3.0 v) to 2016 (4.0) without almost no downtime. The overall process consists in adding the new ADFS server to the farm, assign the primary role to the new ADFS, make some changes and then we’re done.<!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->The current environment is:<!-- raw HTML omitted --></p>
<ul>
<li><!-- raw HTML omitted -->1 x WAP Server (W2012 R2)<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted --><!-- raw HTML omitted -->1 x ADFS Server (W2012 R2)<!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
<p><!-- raw HTML omitted -->No applications published, just an Office 365 <!-- raw HTML omitted -->Relying <!-- raw HTML omitted -->party trust.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->A DNS A record that points <!-- raw HTML omitted -->sts.teselia.com<!-- raw HTML omitted --> to the ADFS IP address.<!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->And the future environment will be:<!-- raw HTML omitted --></p>
<ul>
<li><!-- raw HTML omitted -->1 x WAP Server (W2016) -&gt; Not in this post<!-- raw HTML omitted --> <!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted --><!-- raw HTML omitted -->1 x ADFS Server (W2016) -&gt; In this post<!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
<h2 id="span-stylefont-family-nunito-color-000000strongplanning-for-your-adfs-migrationstrongspan"><!-- raw HTML omitted --><!-- raw HTML omitted -->Planning for your ADFS Migration<!-- raw HTML omitted --><!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-family-nunito-color-000000strongplanning-for-your-adfs-migrationstrongspan">#</a></h2>
<ol>
<li><!-- raw HTML omitted -->Active Directory schema update using ‘ADPrep’ with the Windows Server 2016 additions (not necessary in my case)<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->Build a Windows Server 2016 server with ADFS and join into an existing farm.<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->Promote one of the ADFS 2016 servers as “primary” of the farm, and point all other secondary servers to the new “primary”.<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->Change DNS records to the new servers’s IP address.<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->Raise the Farm Behavior Level feature (FBL) to ‘2016’<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->Test that the setup works correctly.<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->Remove the old ADFS server (W2012 R2) from the farm.<!-- raw HTML omitted --></li>
</ol>
<h2 id="heading"><a hidden class="anchor" aria-hidden="true" href="#heading">#</a></h2>
<h2 id="span-stylefont-family-nunito-color-000000upgrading-schemaspan"><!-- raw HTML omitted -->Upgrading Schema<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-family-nunito-color-000000upgrading-schemaspan">#</a></h2>
<p><!-- raw HTML omitted -->Now, time to upgrade the schema of the AD:<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Put the installation media from W2016 Datacenter:<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Adprep /forestprep<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->In my <!-- raw HTML omitted --><!-- raw HTML omitted -->case, it was already updated (my domain is in W2012 R2 so it seems that I don’t need it).<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<h2 id="span-stylefont-family-nunito-color-000000installing-and-configuring-adfsspan"><!-- raw HTML omitted -->Installing and configuring ADFS<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-family-nunito-color-000000installing-and-configuring-adfsspan">#</a></h2>
<p><!-- raw HTML omitted -->Once we deployed a new Windows Server 2016 and it’s joined to our domain…<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Install the role of ADFS in your target server and then continue with the post-deployment config:<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->Provide can account with Domain Administrator permissions:<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Provide your federation service name. You can review it in the current ADFS primary server and click Properties in the root folder of the ADFS console:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->In our case “<!-- raw HTML omitted -->sts.teselia.com<!-- raw HTML omitted -->”:<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->Specify your SSL certificate (usually your wildcard):<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->Then, I will use an account (Managed service account recommended):<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Review your configuration and after the pre-requisite checks proceed with the «Configure» button:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->After the server is installed you will have some warnings that will be fixed later by rebooting the server and making this new server as the primary ADFS server in the farm:<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Then, we will proceed to reboot our server (ADFS01.teselia.com).<!-- raw HTML omitted --></p>
<p> </p>
<h2 id="span-stylefont-family-nunito-color-000000configuring-as-a-primarycomputer-in-the-adfs-farmspan"><!-- raw HTML omitted -->Configuring as a «PrimaryComputer» in the ADFS farm<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-family-nunito-color-000000configuring-as-a-primarycomputer-in-the-adfs-farmspan">#</a></h2>
<p><!-- raw HTML omitted -->Once the machine has restarted, open the ADFS Management Console, and you’ll notice it’s not the primary federation server in the farm.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Open a PS console and execute: <!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Set-AdfsSyncProperties -Role PrimaryComputer<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->After that, I can access the ADFS console from our new ADFS server without the warning:<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->Execute this on the other ADFS servers (we will point the new ADFS server as the PRIMARY):<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Set-AdfsSyncProperties -Role SecondaryComputer -PrimaryComputerName sts.teselia.com<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Then, we will check that in our old ADFS server it’s correct:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="heading-1"><a hidden class="anchor" aria-hidden="true" href="#heading-1">#</a></h3>
<h3 id="span-stylefont-family-nunito-color-000000details-to-bear-in-mindspan"><!-- raw HTML omitted -->Details to bear in mind<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-family-nunito-color-000000details-to-bear-in-mindspan">#</a></h3>
<p><!-- raw HTML omitted -->So, in my case, I have a DNS A record that points <!-- raw HTML omitted -->sts.teselia.com<!-- raw HTML omitted --> to an IP address (the ADFS server)<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->After pointing the new, I had to modify the hosts file from the WAP server in the DMZ to point to the new server!<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Also, I modified the DNS  record from the <!-- raw HTML omitted -->internal DNS<!-- raw HTML omitted --> with the new server’s IP address.<!-- raw HTML omitted --></p>
<p> </p>
<p> </p>
<h2 id="span-stylefont-family-nunito-color-000000error-with-0365-relying-party-trustspan"><!-- raw HTML omitted -->Error with 0365 relying party trust<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-family-nunito-color-000000error-with-0365-relying-party-trustspan">#</a></h2>
<p><!-- raw HTML omitted -->After migrating the service from ADFS 3.0 (W2012 R2) to ADFS 4.0 (W2016), I faced a  problem when updating the O365 relying party trust.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->The solution was to apply a fix described by Microsoft:<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><a href="https://docs.microsoft.com/en-us/security-updates/SecurityAdvisories/2015/2960358">https://docs.microsoft.com/en-us/security-updates/SecurityAdvisories/2015/2960358</a><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Basically, what you have to do is to add a couple of registry values in this new ADFS server because it’s Windows Server 2016 and is running ADFS 4.0 version.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Once you applied the fix, reboot it and works flawlessly!<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p> </p>
<h2 id="span-stylefont-family-nunitospan-stylecolor-000000testing-the-new-setupspanbr--span"><!-- raw HTML omitted --><!-- raw HTML omitted -->Testing the new setup<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-family-nunitospan-stylecolor-000000testing-the-new-setupspanbr--span">#</a></h2>
<p><!-- raw HTML omitted -->T<!-- raw HTML omitted -->o check that it’s really working, try to log into your Office 365 portal and it must show you the portal from your federation service.<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->As the WAP service isn’t migrated yet, it should respond correctly but if the configuration is not correct, it won’t be able to gather the configuration from the ADFS service.<!-- raw HTML omitted --></p>
<h2 id="span-stylecolor-000000-font-family-nunitoremoving-the-old-adfs-serverspan"><!-- raw HTML omitted -->Removing the old ADFS server<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylecolor-000000-font-family-nunitoremoving-the-old-adfs-serverspan">#</a></h2>
<p><!-- raw HTML omitted -->Once you tested that it works correctly, as both ADFS servers will have the configuration replicated, you can remove the role from the old one (that now holds the secondary role) and then remove it from the domain.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->With that done, you will have a fresh new Windows Server 2016 ADFS server and none «old» ADFS servers.<!-- raw HTML omitted --></p>
<p> </p>
<p> </p>
<p><!-- raw HTML omitted -->And that’s all, I will do in the future another post about the WAP service migration that it’s easier than this one, I hope that this can help someone.<!-- raw HTML omitted --></p>


  </div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://dangaiden.github.io/tags/adfs/">ADFS</a></li>
    </ul>
  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="https://dangaiden.github.io">IT Gaiden</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
