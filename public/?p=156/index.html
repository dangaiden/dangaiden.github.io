<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>vSphere Network I/O Control: NIC Limit bandwidth | IT Gaiden</title>
<meta name="keywords" content="networking, NIOC, VMware" />
<meta name="description" content="Today let’s talk about vSphere Network I/O Control (NIOC) version 3 (vSphere 6.0), it’s a feature in the vSphere Distributed Switch that allows you to control granularly the output/egress bandwidth from a VM network adapter level. Besides there are other useful options within NIOC capabilities, today, I will focus only in the network adapter bandwidth limitfor VMs.Prerequisites: Enable the feature in the dvSwitch (in our case the one with Data Network):Scenario:2 VMs within 2 Networks (Portgroups in dvSwitch)KenshiroVMis a VM with Ubuntu that simulates traffic with iperf as a client.">
<meta name="author" content="itgaiden">
<link rel="canonical" href="https://dangaiden.github.io/?p=156/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.35cd0f65a15cafa92372b8313deef5960aae04b90ad722f2bbf509eb0468137e.css" integrity="sha256-Nc0PZaFcr6kjcrgxPe71lgquBLkK1yLyu/UJ6wRoE34=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://dangaiden.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://dangaiden.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://dangaiden.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://dangaiden.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://dangaiden.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.85.0" />
<meta property="og:title" content="vSphere Network I/O Control: NIC Limit bandwidth" />
<meta property="og:description" content="Today let’s talk about vSphere Network I/O Control (NIOC) version 3 (vSphere 6.0), it’s a feature in the vSphere Distributed Switch that allows you to control granularly the output/egress bandwidth from a VM network adapter level. Besides there are other useful options within NIOC capabilities, today, I will focus only in the network adapter bandwidth limitfor VMs.Prerequisites: Enable the feature in the dvSwitch (in our case the one with Data Network):Scenario:2 VMs within 2 Networks (Portgroups in dvSwitch)KenshiroVMis a VM with Ubuntu that simulates traffic with iperf as a client." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dangaiden.github.io/?p=156/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-02T23:39:01&#43;00:00" />
<meta property="article:modified_time" content="2018-08-02T23:39:01&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="vSphere Network I/O Control: NIC Limit bandwidth"/>
<meta name="twitter:description" content="Today let’s talk about vSphere Network I/O Control (NIOC) version 3 (vSphere 6.0), it’s a feature in the vSphere Distributed Switch that allows you to control granularly the output/egress bandwidth from a VM network adapter level. Besides there are other useful options within NIOC capabilities, today, I will focus only in the network adapter bandwidth limitfor VMs.Prerequisites: Enable the feature in the dvSwitch (in our case the one with Data Network):Scenario:2 VMs within 2 Networks (Portgroups in dvSwitch)KenshiroVMis a VM with Ubuntu that simulates traffic with iperf as a client."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://dangaiden.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "vSphere Network I/O Control: NIC Limit bandwidth",
      "item": "https://dangaiden.github.io/?p=156/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "vSphere Network I/O Control: NIC Limit bandwidth",
  "name": "vSphere Network I\/O Control: NIC Limit bandwidth",
  "description": "Today let’s talk about vSphere Network I/O Control (NIOC) version 3 (vSphere 6.0), it’s a feature in the vSphere Distributed Switch that allows you to control granularly the output/egress bandwidth from a VM network adapter level. Besides there are other useful options within NIOC capabilities, today, I will focus only in the network adapter bandwidth limitfor VMs.Prerequisites: Enable the feature in the dvSwitch (in our case the one with Data Network):Scenario:2 VMs within 2 Networks (Portgroups in dvSwitch)KenshiroVMis a VM with Ubuntu that simulates traffic with iperf as a client.",
  "keywords": [
    "networking", "NIOC", "VMware"
  ],
  "articleBody": "Today let’s talk about vSphere Network I/O Control (NIOC) version 3 (vSphere 6.0), it’s a feature in the vSphere Distributed Switch that allows you to control granularly the output/egress bandwidth from a VM network adapter level. Besides there are other useful options within NIOC capabilities, today, I will focus only in the network adapter bandwidth limitfor VMs.Prerequisites: Enable the feature in the dvSwitch (in our case the one with Data Network):Scenario:2 VMs within 2 Networks (Portgroups in dvSwitch)KenshiroVMis a VM with Ubuntu that simulates traffic with iperf as a client.Win10Prois a VM with iperfapplication configured as a server:Objective: We will look in how Network I/O control (NIOC) let us limit the bandwidth granularly from a Virtual Machine (KenshiroVM), so, we will limit the bandwidth for a single NIC and see if it really works.Testing: Lab time! I enabled NIOC in the dvSwitch that I have created for OS traffic (Data Network), dvSwitch is called “DSwitch_DataNW”. The other dvSwitch is “DSwitchMGMT” and NIOC is not enabled (no NIOC = no restrictions).As I said before we have 2 networks: Data Network: 10.10.6.0/24 Management Network: 192.168.1.0/24  Main steps:  1.Currently, KenshiroVM has no restrictions configured (notice that in the blue rectangle there are no options for NIOC because that portgroup (Management) it’s located in another dvSwitch where we didn’t enable NIOC):If we launch iperf command with 200Mbps on port 9999 from KenshiroVM:We can see the traffic on the destination(Win10Pro) on the Data Network Adapter (you can see the subnet in the screenshot):Also, we can review it in vSphere Web Client (25 MBps = 200 Mbps):2.Now we are going to set a limiton KenshiroVM Data Network adapter to 88 Mbits:Now, we perform the same command with iperf on the client (KenshiroVM):Even pushing 200 Mbitsthrough the Data Netowork Adapter using iperf, NIOC will limit the traffic to 88 Mbits as set before. Here is the traffic seen by Win10Pro Data Network adapter:In KenshiroVM, iperfperformed the transfer in 88 Mbps approximately:3.Now, if we do the same experiment (150 Mbps) but in the adapter where NIOC is not enabled:KenshiroVM confirmed that it performed at 150 Mbps approximately:As a result of using vSphere NIOC, we can granularly set limits in the bandwidth in a VM network adapter and it will obey the settings configured. It only works for outbound traffic, if you set a limit in a destination VM adapter, then, NIOC will not make any restrictions regarding the inbound traffic.",
  "wordCount" : "402",
  "inLanguage": "en",
  "datePublished": "2018-08-02T23:39:01Z",
  "dateModified": "2018-08-02T23:39:01Z",
  "author":{
    "@type": "Person",
    "name": "itgaiden"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dangaiden.github.io/?p=156/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "IT Gaiden",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dangaiden.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://dangaiden.github.io" accesskey="h" title="IT Gaiden (Alt + H)">IT Gaiden</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      vSphere Network I/O Control: NIC Limit bandwidth
    </h1>
    <div class="post-meta">August 2, 2018&nbsp;·&nbsp;itgaiden
</div>
  </header> 
  <div class="post-content"><p><!-- raw HTML omitted -->Today let’s talk about vSphere Network I/O Control (NIOC) version 3 (vSphere 6.0), it’s a feature in the vSphere Distributed Switch that allows you to control granularly the output/egress bandwidth from a VM network adapter level. Besides there are other useful options within NIOC capabilities, today, I will focus <!-- raw HTML omitted -->only in the network adapter bandwidth limit<!-- raw HTML omitted --> for VMs.<!-- raw HTML omitted --></p>
<h3 id="span-stylefont-size-24px-font-family-didact-gothicstrongprerequisitesstrongspan"><!-- raw HTML omitted --><!-- raw HTML omitted -->Prerequisites:<!-- raw HTML omitted --><!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-size-24px-font-family-didact-gothicstrongprerequisitesstrongspan">#</a></h3>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Enable the feature in the dvSwitch (in our case the one with Data Network):<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Scenario:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->2 VMs within 2 Networks (Portgroups in dvSwitch)<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->KenshiroVM<!-- raw HTML omitted --> is a VM with Ubuntu that simulates traffic with iperf as a client.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Win10Pro<!-- raw HTML omitted --> is a VM with <!-- raw HTML omitted -->iperf<!-- raw HTML omitted --> application configured as a server:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="span-stylefont-size-24px-font-family-didact-gothicstrongobjectivestrongspan"><!-- raw HTML omitted --><!-- raw HTML omitted -->Objective:<!-- raw HTML omitted --><!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-size-24px-font-family-didact-gothicstrongobjectivestrongspan">#</a></h3>
<p><!-- raw HTML omitted -->We will look in how Network I/O control (NIOC) let us limit the bandwidth granularly from a Virtual Machine (KenshiroVM), so, we will limit the bandwidth for a single NIC and see if it really works.<!-- raw HTML omitted --></p>
<h3 id="span-stylefont-size-24px-font-family-didact-gothicstrongtestingstrongspan"><!-- raw HTML omitted --><!-- raw HTML omitted -->Testing:<!-- raw HTML omitted --><!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-size-24px-font-family-didact-gothicstrongtestingstrongspan">#</a></h3>
<p><!-- raw HTML omitted -->Lab time! I enabled NIOC in the dvSwitch that I have created for OS traffic (Data Network), dvSwitch is called “DSwitch_DataNW”. The other dvSwitch is “DSwitchMGMT” and NIOC is not enabled (no NIOC = no restrictions).<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->As I said before we have 2 networks:<!-- raw HTML omitted --></p>
<ul>
<li><!-- raw HTML omitted -->Data Network: 10.10.6.0/24<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->Management Network: 192.168.1.0/24<!-- raw HTML omitted --></li>
</ul>
<h4 id="span-stylefont-family-didact-gothic-font-size-20pxmain-stepsspan"><strong><!-- raw HTML omitted -->Main steps:<!-- raw HTML omitted --></strong><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-family-didact-gothic-font-size-20pxmain-stepsspan">#</a></h4>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<hr>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->1.<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted -->Currently, KenshiroVM has no restrictions configured (notice that in the blue rectangle there are no options for NIOC because that portgroup (Management) it’s located in another dvSwitch where we didn’t enable NIOC):<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->If we launch iperf command with 200Mbps on port 9999 from KenshiroVM:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->We can see the traffic <!-- raw HTML omitted -->on the destination<!-- raw HTML omitted --> (<!-- raw HTML omitted -->Win10Pro<!-- raw HTML omitted -->) on the Data Network Adapter (you can see the subnet in the screenshot):<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Also, we can review it in vSphere Web Client (25 MBps = 200 Mbps):<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->2.<!-- raw HTML omitted --> Now we are going to <!-- raw HTML omitted -->set a limit<!-- raw HTML omitted --> on KenshiroVM Data Network adapter to 88 Mbits:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Now, we perform the same command with iperf on the client (KenshiroVM):<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Even pushing 200 Mbits<!-- raw HTML omitted --> through the Data Netowork Adapter using iperf, NIOC will limit the traffic to 88 Mbits as set before. Here is the traffic seen by Win10Pro Data Network adapter:<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->In KenshiroVM, <!-- raw HTML omitted -->iperf<!-- raw HTML omitted --> performed the transfer in 88 Mbps approximately:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->3.<!-- raw HTML omitted --> Now, if we do the same experiment (150 Mbps) but in the adapter where NIOC is not enabled:<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->KenshiroVM confirmed that it performed at 150 Mbps approximately:<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->As a result of using vSphere NIOC,  we can granularly set limits in the bandwidth in a VM network adapter and it will obey the settings configured. <!-- raw HTML omitted -->It only works for outbound traffic<!-- raw HTML omitted -->, if you set a limit in a destination VM adapter, then, NIOC will not make any restrictions regarding the inbound traffic.<!-- raw HTML omitted --></p>


  </div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://dangaiden.github.io/tags/networking/">networking</a></li>
      <li><a href="https://dangaiden.github.io/tags/nioc/">NIOC</a></li>
      <li><a href="https://dangaiden.github.io/tags/vmware/">VMware</a></li>
    </ul>
  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="https://dangaiden.github.io">IT Gaiden</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
