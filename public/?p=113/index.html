<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Azure – Error when adding new rule on NSG | IT Gaiden</title>
<meta name="keywords" content="azure, CIDR, nsg" />
<meta name="description" content="Hello everyone!It’s been a while since I wrote something, but I was so busy with other things (University) and I wasn’t able to allocate time to write anything.Today I’m going to talk about an issue I found on Azure when trying to add new rules to some NSGs.To create rules in Azure I used this script from TechNet Gallery: https://gallery.technet.microsoft.com/scriptcenter/Create-Azure-Network-5f5c5332Problem I was trying to add some rules in an NSG with the address 193.">
<meta name="author" content="itgaiden">
<link rel="canonical" href="https://dangaiden.github.io/?p=113/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.35cd0f65a15cafa92372b8313deef5960aae04b90ad722f2bbf509eb0468137e.css" integrity="sha256-Nc0PZaFcr6kjcrgxPe71lgquBLkK1yLyu/UJ6wRoE34=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://dangaiden.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://dangaiden.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://dangaiden.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://dangaiden.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://dangaiden.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.85.0" />
<meta property="og:title" content="Azure – Error when adding new rule on NSG" />
<meta property="og:description" content="Hello everyone!It’s been a while since I wrote something, but I was so busy with other things (University) and I wasn’t able to allocate time to write anything.Today I’m going to talk about an issue I found on Azure when trying to add new rules to some NSGs.To create rules in Azure I used this script from TechNet Gallery: https://gallery.technet.microsoft.com/scriptcenter/Create-Azure-Network-5f5c5332Problem I was trying to add some rules in an NSG with the address 193." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dangaiden.github.io/?p=113/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-12-31T15:50:35&#43;00:00" />
<meta property="article:modified_time" content="2017-12-31T15:50:35&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Azure – Error when adding new rule on NSG"/>
<meta name="twitter:description" content="Hello everyone!It’s been a while since I wrote something, but I was so busy with other things (University) and I wasn’t able to allocate time to write anything.Today I’m going to talk about an issue I found on Azure when trying to add new rules to some NSGs.To create rules in Azure I used this script from TechNet Gallery: https://gallery.technet.microsoft.com/scriptcenter/Create-Azure-Network-5f5c5332Problem I was trying to add some rules in an NSG with the address 193."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://dangaiden.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Azure – Error when adding new rule on NSG",
      "item": "https://dangaiden.github.io/?p=113/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Azure – Error when adding new rule on NSG",
  "name": "Azure – Error when adding new rule on NSG",
  "description": "Hello everyone!It’s been a while since I wrote something, but I was so busy with other things (University) and I wasn’t able to allocate time to write anything.Today I’m going to talk about an issue I found on Azure when trying to add new rules to some NSGs.To create rules in Azure I used this script from TechNet Gallery: https://gallery.technet.microsoft.com/scriptcenter/Create-Azure-Network-5f5c5332Problem I was trying to add some rules in an NSG with the address 193.",
  "keywords": [
    "azure", "CIDR", "nsg"
  ],
  "articleBody": "Hello everyone!It’s been a while since I wrote something, but I was so busy with other things (University) and I wasn’t able to allocate time to write anything.Today I’m going to talk about an issue I found on Azure when trying to add new rules to some NSGs.To create rules in Azure I used this script from TechNet Gallery: https://gallery.technet.microsoft.com/scriptcenter/Create-Azure-Network-5f5c5332Problem I was trying to add some rules in an NSG with the address 193.23.120.230/30and, when I execute the code, the output was:Set-AzureRmNetworkSecurityGroup : Security rule has invalid Address prefix. Value provided: 193.23.120.230/30.StatusCode: 400ReasonPhrase: Bad RequestOperationID : ‘b2f7-b2f7-b2f7’At line:4 char:55+ … efix 193.23.120.230/30 -SourcePortRange * | Set-AzureRmNetworkSecurityGroup+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+ CategoryInfo : CloseError: (:) [Set-AzureRmNetworkSecurityGroup], NetworkCloudException+ FullyQualifiedErrorId : Microsoft.Azure.Commands.Network.SetAzureNetworkSecurityGroupCommandTried again and again, and this only happened in certain NSGs, so well I thought there was a problem with the command line, I tried the same with the GUI and… the same.Solution Investigating the error it didn’t match with any of the new rules I was trying to add. Address 193.23.120.230/30 seems correct but if we use a subnet calculator, you will see this:The right address should be deleting all ones after the netmask because it doesn’t care about what is after the netmask bits.This means that the new address is 193.23.120.228/30 because we put zeros instead of ones after the netmask bits.So, it seems a CIDN error! Seems that Azure let me add this rules in the past, but now it’s not accepting it so, if we change it the way that subnet calculator does, problem resolved!Solution? Had to delete the non-compliant CIDR rules and added the new ones CIDR compliant.Executed the same in other NSGs and worked like a charm.All rules are finally shown in Azure Panel:Well, seems that Azure didn’t comply with CIDR addresses in the past and now it’s mandatory if it founds any non-compliant CIDR rule. An easy mistake that we can avoid checking our addresses before we try to add them to Azure.And that’s all, Happy New Year!",
  "wordCount" : "330",
  "inLanguage": "en",
  "datePublished": "2017-12-31T15:50:35Z",
  "dateModified": "2017-12-31T15:50:35Z",
  "author":{
    "@type": "Person",
    "name": "itgaiden"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dangaiden.github.io/?p=113/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "IT Gaiden",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dangaiden.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://dangaiden.github.io" accesskey="h" title="IT Gaiden (Alt + H)">IT Gaiden</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Azure – Error when adding new rule on NSG
    </h1>
    <div class="post-meta">December 31, 2017&nbsp;·&nbsp;itgaiden
</div>
  </header> 
  <div class="post-content"><p><!-- raw HTML omitted -->Hello everyone!<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->It’s been a while since I wrote something, but I was so busy with other things (University) and I wasn’t able to allocate time to write anything.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Today I’m going to talk about an issue I found on Azure when trying to add new rules to some NSGs.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->To create rules in Azure I used this script from TechNet Gallery: <!-- raw HTML omitted --><a href="https://gallery.technet.microsoft.com/scriptcenter/Create-Azure-Network-5f5c5332">https://gallery.technet.microsoft.com/scriptcenter/Create-Azure-Network-5f5c5332</a><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="span-stylefont-family-didact-gothicproblemspan"><!-- raw HTML omitted -->Problem<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-family-didact-gothicproblemspan">#</a></h2>
<p><!-- raw HTML omitted -->I was trying to add some rules in an NSG with the address <!-- raw HTML omitted -->193.23.120.230/30<!-- raw HTML omitted --> and, when I execute the code, the output was:<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Set-AzureRmNetworkSecurityGroup : Security rule has invalid Address prefix. Value provided: 193.23.120.230/30.<!-- raw HTML omitted --> StatusCode: 400<!-- raw HTML omitted --> ReasonPhrase: Bad Request<!-- raw HTML omitted --> OperationID : ‘b2f7-b2f7-b2f7’<!-- raw HTML omitted --> At line:4 char:55<!-- raw HTML omitted --> + … efix 193.23.120.230/30 -SourcePortRange * | Set-AzureRmNetworkSecurityGroup<!-- raw HTML omitted --> +                                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<!-- raw HTML omitted --> + CategoryInfo          : CloseError: (:) [Set-AzureRmNetworkSecurityGroup], NetworkCloudException<!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --> + FullyQualifiedErrorId : Microsoft.Azure.Commands.Network.SetAzureNetworkSecurityGroupCommand<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Tried again and again, and this only happened in certain NSGs, so well I thought there was a problem with the command line, I tried the same with the GUI and… the same.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="span-stylefont-family-didact-gothicsolutionspan"><!-- raw HTML omitted -->Solution<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#span-stylefont-family-didact-gothicsolutionspan">#</a></h2>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Investigating the error it didn’t match with any of the new rules I was trying to add. <!-- raw HTML omitted --><!-- raw HTML omitted -->Address 193.23.120.<!-- raw HTML omitted -->230<!-- raw HTML omitted -->/30 seems correct but if we use a subnet calculator, you will see this:<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->The right address should be deleting all ones after the netmask because it doesn’t care about what is after the netmask bits.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->This means that the new address is <!-- raw HTML omitted -->193.23.120.228/30 <!-- raw HTML omitted -->because we put zeros instead of ones after the netmask bits.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->So, it seems a CIDN error! Seems that Azure let me add this rules in the past, but now it’s not accepting it so, if we change it the way that subnet calculator does, problem resolved!<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->Solution? Had to delete the non-compliant CIDR rules and added the new ones CIDR compliant.<!-- raw HTML omitted --> <!-- raw HTML omitted -->Executed the same in other NSGs and worked like a charm.<!-- raw HTML omitted --><!-- raw HTML omitted --><br>
<!-- raw HTML omitted -->All rules are finally shown in Azure Panel:<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Well, seems that Azure didn’t comply with CIDR addresses in the past and now it’s mandatory if it founds any non-compliant CIDR rule. An easy mistake that we can avoid checking our addresses before we try to add them to Azure.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->And that’s all, <!-- raw HTML omitted -->Happy New Year<!-- raw HTML omitted -->!<!-- raw HTML omitted --></p>


  </div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://dangaiden.github.io/tags/azure/">azure</a></li>
      <li><a href="https://dangaiden.github.io/tags/cidr/">CIDR</a></li>
      <li><a href="https://dangaiden.github.io/tags/nsg/">nsg</a></li>
    </ul>
  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="https://dangaiden.github.io">IT Gaiden</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
